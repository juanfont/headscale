# Regenerating Protobuf Files

The generated protobuf files in `gen/go/headscale/v1/` need to be regenerated after changing the proto files or package paths.

## Prerequisites

You need either:
1. **Nix environment** (recommended): `nix develop`
2. **Manual install**: Go, buf, protoc-gen-go, protoc-gen-go-grpc, protoc-gen-grpc-gateway

## Regenerate Locally

```bash
# Enter nix environment (recommended)
nix develop

# Run generation
make generate

# Or run directly
go generate ./...
```

## If You Don't Have Nix/Go Installed Locally

The protobuf files will be automatically regenerated by GitHub Actions when you push changes to proto files. The `check-generated.yml` workflow will fail if generated files are out of date, and you can manually trigger the `regenerate-proto.yml` workflow to regenerate them.

### Manual Workflow Trigger

1. Go to https://github.com/skitzo2000/headscale/actions/workflows/regenerate-proto.yml
2. Click "Run workflow"
3. Select the `0.28.007` branch
4. Click "Run workflow"

This will regenerate the proto files and commit them automatically.

## What Was Changed

After forking from `juanfont/headscale` to `skitzo2000/headscale`, we changed:
- Module path in `go.mod`
- All Go import statements
- Proto package path in `proto/headscale/v1/*.proto` files

The generated files contain embedded binary descriptors that reference the old package paths, so they must be fully regenerated, not just text-replaced.

## Current Status

The generated files have been removed from the repository and need to be regenerated. This is intentional - the old generated files had corrupted binary descriptors after the package path changes.

